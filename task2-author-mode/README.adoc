= Task 2: Set Up Author Mode

In this task, you will set up *author mode* in Antora, allowing you to edit multiple branches of the same repositories locally.

== Learning objectives

- Learn how to set up and work in *author mode* to manage multiple repositories and branches locally.
- Understand how to create Git worktrees to streamline content editing across different branches.

== Prerequisites

- *Git*
+
Run the following command to check if Git is installed:
+
[source,bash]
----
git --version
----
+
If Git is not installed, https://git-scm.com[download and install it].

- *Node.js*
+
Make sure Node.js is installed. You can verify its installation by running:
+
[source,bash]
----
node --version
----
+
If Node.js is not installed, https://nodejs.org/[download and install it].

== Steps

. Create a workspace directory.
+
The `workspace` directory will hold all of your local clones of the repositories you want to work on.
+
--
- Open a terminal (or command prompt) and navigate to the directory where you want to set up the workspace.
- Create a directory called `workspace`:
--
+
[source,bash]
----
mkdir workspace
----

. Clone repositories into the workspace.
+
For each repository you want to clone, follow these steps:
+
- Clone the repository's main branch into your workspace:
+
[source,bash]
----
cd workspace
mkdir docs
git clone https://github.com/redpanda-data/docs.git docs/main
----
+
This will clone the repository's `main` branch into a directory named `main` under `workspace/docs`.

. Create worktrees for additional branches.
+
If you need to work on additional branches (such as `v/24.1` or `api`), you can use Git worktrees to check out multiple branches simultaneously without switching branches in your main directory.
+
- Navigate to the `main` directory of your repository:
+
[source,bash]
----
cd workspace/docs/main
----

- Create worktrees for each additional branch:
+
[source,bash]
----
git worktree add ../v-24.1 v/24.1
git worktree add ../api api
----
+
This will create directories for each branch (`v-24.1`, `api`), allowing you to work on multiple branches locally. The slashes (`/`) in branch names are replaced with hyphens (`-`) to avoid conflicts with directory paths.

. Update your Antora playbook.
+
When you've set up the repositories and their branches, you need to update your Antora playbook to use the local content.
+
- Update the `content.sources` section of the playbook to point to the local workspace. For example:
+
[source,yaml]
----
content:
  sources:
    - url: ./workspace/docs/main
      branches: [main, v/*, api]
      worktrees: true
----
+
This tells Antora to use the local workspace for building the documentation, using the `main`, `v/*`, and `api` branches.

. Build the docs.
+
[source,bash]
----
npm run build
npm run serve
----
+
This will generate the site using the content from the repositories and branches in your local workspace.

. Commit your changes.
+
After making changes to any of the local branches, you can commit your changes back to the repository.
+
For each branch, follow these steps:
+
--
- Navigate to the corresponding worktree directory:
+
[source,bash]
----
cd workspace/docs/v-24.1
----

- Stage the changes you've made:
+
[source,bash]
----
git add .
----

- Commit the changes:
+
[source,bash]
----
git commit -m "Describe the changes you made"
----

- Push the changes back to the remote repository:
+
[source,bash]
----
git push origin v/24.1
----
+
--
Repeat these steps for any other branches you've worked on.

== Useful links

- https://docs.antora.org/antora/latest/playbook/configure-content-sources/
- https://docs.antora.org/antora/latest/playbook/content-source-url/#local-urls
- https://docs.antora.org/antora/latest/playbook/content-branches/#current-local-branch
- https://docs.antora.org/antora/latest/playbook/author-mode

== Next steps

xref:../task3-troubleshoot-build/README.adoc[Task 3: Troubleshoot Antora Build Errors]