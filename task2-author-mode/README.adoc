= Task 2: Set Up Author Mode

In this task, you will set up *author mode* in Antora, allowing you to edit multiple branches of the same repositories locally.

== Learning objectives

- Learn how to set up and work in *author mode* to manage multiple repositories and branches locally.
- Understand how to create Git worktrees to streamline content editing across different branches.

== Prerequisites

- *Git*
+
Run the following command to check if Git is installed:
+
[source,bash]
----
git --version
----
+
If Git is not installed, https://git-scm.com[download and install it].

- *Node.js*
+
Make sure Node.js is installed. You can verify its installation by running:
+
[source,bash]
----
node --version
----
+
If Node.js is not installed, https://nodejs.org/[download and install it].

== Steps

. Change into the `task2-author-mode/` directory.
+
[,bash]
----
cd task2-author-mode
----

. Install the dependencies:
+
[,bash]
----
npm install
----

. Create a workspace directory.
+
[source,bash]
----
mkdir workspace
----
+
The `workspace` directory will hold all of your local clones of the repositories you want to work on.

. Clone the `docs` repository into the workspace.
+
[source,bash]
----
cd workspace
mkdir docs
git clone https://github.com/redpanda-data/docs.git docs/main
----
+
This will clone the `docs` repository's `main` branch into a directory named `main` under `workspace/docs`.

. Create worktrees for additional branches.
+
If you need to work on additional branches (such as `v/24.1` or `api`), you can use Git worktrees to check out multiple branches simultaneously without switching branches in your main directory.
+
.. Navigate to the `main` directory of your local `docs` repository:
+
[source,bash]
----
cd workspace/docs/main
----

.. Create worktrees for each additional branch:
+
[source,bash]
----
git worktree add ../v-24.1 v/24.1
git worktree add ../api api
----
+
This will create directories for each branch (`v-24.1`, `api`), allowing you to work on multiple branches locally. The slashes (`/`) in branch names are replaced with hyphens (`-`) to avoid conflicts with directory paths.

. Update your local playbook.
+
When you've set up the repositories and their branches, you need to update your Antora playbook to use the local content.
+
- Update the `content.sources` section of the playbook to point to the local workspace. For example:
+
[source,yaml]
----
content:
  sources:
    - url: ./workspace/docs/main
      branches: [main, v/*, api]
      worktrees: true
----
+
This tells Antora to use the local workspace for building the documentation, using the `main`, `v/*`, and `api` branches.

. Build the docs.
+
[source,bash]
----
npm run build
npm run serve
----
+
This will generate the site using the content from the repositories and branches in your local workspace.


== Useful links

- https://docs.antora.org/antora/latest/playbook/configure-content-sources/
- https://docs.antora.org/antora/latest/playbook/content-source-url/#local-urls
- https://docs.antora.org/antora/latest/playbook/content-branches/#current-local-branch
- https://docs.antora.org/antora/latest/playbook/author-mode

== Next steps

xref:../task3-troubleshoot-build/README.adoc[Task 3: Troubleshoot Antora Build Errors]